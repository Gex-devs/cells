(()=>{"use strict";var e={880:e=>{e.exports=require("pydio/http/api")},6:e=>{e.exports=require("pydio/model/node")}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,r),i.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};(()=>{r.r(n),r.d(n,{Callbacks:()=>D,HistoryDialog:()=>T,InfoPanel:()=>W});const e=require("pydio");var t=r.n(e);const o=require("react");var i=r.n(o);const a=require("create-react-class");var s=r.n(a);const l=require("pydio/model/meta-node-provider");var u=r.n(l);const c=require("react-markdown");var f=r.n(c);const p=require("pydio/util/path");var y=r.n(p);const d=require("lodash.debounce");var v=r.n(d);function b(e){return b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},b(e)}var m=["node"],g=["node"];function h(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==b(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==b(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===b(o)?o:String(o)),n)}var o}function w(e,t){return w=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},w(e,t)}function O(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function P(e){return P=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},P(e)}function S(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var j=r(880),E=r(6),_=t().requireLib("components"),M=_.Timeline,k=_.UserAvatar,x=t().requireLib("boot").moment,C={a:function(e){return e.node,function(e){var r=e.href,n=e.children;if(r.startsWith("user://")){var o=r.replace("user://","");return i().createElement(k,{userId:o,displayAvatar:!1,richOnClick:!1,style:{display:"inline-block",fontWeight:500},pydio:t().getInstance()})}return i().createElement("span",null,n)}(S(e,m))},p:function(e){var t;return e.node,t=S(e,g).children,i().createElement("span",null,t)}};const q=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&w(e,t)}(l,e);var r,n,o,a,s=(o=l,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=P(o);if(a){var r=P(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===b(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return O(e)}(this,e)});function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=s.call(this,e)).state={loading:!0,revs:[],selection:e.preselection},t._bload=v()(t.load.bind(O(t)),1500),t.load(),t}return r=l,(n=[{key:"componentDidUpdate",value:function(e,t,r){e.node!==this.props.node&&(e.node&&e.node.stopObserving("node_replaced",this._bload),this.props.node&&this.props.node.observe("node_replaced",this._bload),this.load())}},{key:"getMessage",value:function(e){return t().getMessages()["meta.versions."+e]||e}},{key:"load",value:function(){var e=this,t=this.props.node,r=new(u())({versions:"true",file:t.getPath(),silent:!0}),n=new E("/",!1,"Versions","folder.png",r);this.setState({empty:!1}),r.loadNode(n,(function(t){var r=[];t.getChildren().forEach((function(e){return r.push(e)})),e.setState({loading:!1,revs:r,empty:!r.length})}))}},{key:"applyAction",value:function(e,t){var r=this.props,n=r.node,o=r.onRequestClose;switch(e){case"dl":j.getClient().openVersion(n,t.getMetadata().get("versionId"));break;case"revert":if(!confirm(this.getMessage("13")))return;j.getClient().revertToVersion(n,t.getMetadata().get("versionId"),(function(){o&&o()}))}}},{key:"itemActions",value:function(e,t,r){var n=this;return t?[{onClick:function(){return n.applyAction("dl",e)},label:this.getMessage("3")},{onClick:function(){return n.applyAction("revert",e)},label:this.getMessage("7")}]:[]}},{key:"itemAnnotations",value:function(e,t,r){var n,o=parseInt(e.getMetadata().get("bytesize"));if(r){var a=parseInt(r.getMetadata().get("bytesize"));n=a===o?"right":a>o?"bottom-right":"top-right"}return i().createElement("div",{className:"tl-annotation"},n&&i().createElement("span",{className:"tl-annotation-dir mdi mdi-arrow-"+n}),y().roundFileSize(o))}},{key:"render",value:function(){var e=this.state,r=e.loading,n=e.revs,o=e.selection,a=e.empty;if(r)return i().createElement("div",{style:{textAlign:"center",fontWeight:500,opacity:.3,padding:20}},t().getMessages()[466]);if(a)return i().createElement("div",{style:{textAlign:"center",fontWeight:500,opacity:.3,padding:20,paddingBottom:30}},this.getMessage("14"));var s=this.props,l=s.className,u=void 0===l?"":l,c=s.onClick;return i().createElement(M,{items:n,className:u,useSelection:!0,preSelection:o,onItemSelect:c,itemUuid:function(e){return e.getMetadata().get("versionId")},itemMoment:function(e){return x(1e3*e.getMetadata().get("ajxp_modiftime"))},itemDesc:function(e){return i().createElement(f(),{urlTransform:function(e){return e},components:C},e.getMetadata().get("versionDescription"))},itemActions:this.itemActions.bind(this),itemAnnotations:this.itemAnnotations.bind(this),color:"#2196f3"})}}])&&h(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),l}(o.Component);var I=t().requireLib("boot"),T=s()({displayName:"HistoryDialog",mixins:[I.ActionDialogMixin,I.SubmitButtonProviderMixin],getDefaultProps:function(){return{dialogTitle:t().getMessages()["meta.versions.2"],dialogIsModal:!1,dialogSize:"lg",dialogPadding:!1}},submit:function(){this.dismiss()},render:function(){var e,t=this.props,r=t.node,n=t.args;return n&&n.length>0&&(e=n[0]),i().createElement("div",{style:{width:"100%"},className:"layout-fill vertical-layout"},i().createElement("div",{style:{display:"flex",flexDirection:"column",color:"rgba(0,0,0,.87)"},className:"version-history"},i().createElement(q,{node:r,preselection:e,onRequestClose:this.dismiss.bind(this)})))}});function A(e){return A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},A(e)}function R(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==A(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==A(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===A(o)?o:String(o)),n)}var o}var D=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var r,n;return r=e,n=[{key:"loadHistoryBrowser",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];pydio.UI.openComponentInModal("PydioVersioning","HistoryDialog",{node:t().getInstance().getContextHolder().getUniqueNode(),args:r})}}],null&&R(r.prototype,null),n&&R(r,n),Object.defineProperty(r,"prototype",{writable:!1}),e}();function N(e){return N="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},N(e)}function B(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==N(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==N(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===N(o)?o:String(o)),n)}var o}function H(e,t){return H=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},H(e,t)}function L(e){return L=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},L(e)}var U=t().requireLib("boot").PydioContextConsumer,V=t().requireLib("workspaces").InfoPanelCard,z=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&H(e,t)}(l,e);var r,n,o,a,s=(o=l,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=L(o);if(a){var r=L(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===N(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function l(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),s.apply(this,arguments)}return r=l,(n=[{key:"render",value:function(){var e=this.props.node;return e&&e.getMetadata().has("datasource_versioning")?i().createElement(V,{identifier:"meta-versions",style:this.props.style,title:t().getMessages()["meta.versions.1"]},i().createElement(q,{node:e,className:"small",onClick:function(e){return t().getInstance().Controller.fireAction("versions_history",e)}})):null}}])&&B(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),l}(o.Component);const W=z=U(z)})(),window.PydioVersioning=n})();